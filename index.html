<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>MDT ‚Äì DoJ & LSPD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* Dein CSS unver√§ndert */
    :root {
      --bg:#05070f;
      --surface:#0b1220;
      --panel:#111827;
      --glass:rgba(17,25,40,.75);
      --accent:#4f46e5;
      --accent-2:#22d3ee;
      --danger:#ef4444;
      --success:#22c55e;
      --judge:#facc15;
      --lspd:#3b82f6;
      --marshal:#22c55e;
      --doj:#a855f7;
      --text:#e5e7eb;
      --muted:#94a3b8;
    }
    *{box-sizing:border-box}
    body{ margin:0; font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,sans-serif; background:radial-gradient(1200px 600px at 10% -20%,#1e293b,transparent),radial-gradient(800px 400px at 90% 10%,#020617,transparent),var(--bg); color:var(--text);
}
.tablet{
  max-width:1900px;
  min-height:95vh;
  margin:16px auto;
  display:flex;
  border-radius:32px;
  overflow:hidden;
  background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.01));
  box-shadow:0 40px 120px rgba(0,0,0,.7);
}
.sidebar{
  width:300px;
  padding:26px 22px;
  background:linear-gradient(180deg,#020617,#020617 60%,#020617cc);
  border-right:1px solid rgba(255,255,255,.06);
  display:flex;
  flex-direction:column;
}
.sidebar h2{
  font-size:22px;
  margin-bottom:18px;
  letter-spacing:.3px;
}
.sidebar button{
  all:unset;
  padding:14px 18px;
  border-radius:16px;
  margin-bottom:10px;
  background:rgba(255,255,255,.03);
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:12px;
  font-size:15px;
  transition:.25s ease;
}
.sidebar button:hover{
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
}
.main{
  flex:1;
  padding:34px;
  overflow-y:auto;
}
section{
  background:var(--glass);
  backdrop-filter: blur(20px);
  padding:32px;
  border-radius:28px;
  margin-bottom:26px;
  border:1px solid rgba(255,255,255,.08);
}
h3{font-size:28px;margin-bottom:18px}
h4{font-size:18px;margin:18px 0 10px;color:var(--muted)}
input,select,textarea{
  width:100%;
  padding:16px 18px;
  margin-top:10px;
  background:rgba(2,6,23,.85);
  color:var(--text);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  font-size:15px;
}
textarea{min-height:140px}
button.action{
  margin-top:16px;
  padding:16px 26px;
  border-radius:20px;
  border:none;
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  color:#fff;
  font-size:15px;
  cursor:pointer;
}
.role-judge{--accent:var(--judge);--accent-2:#fde047}
.role-lspd{--accent:var(--lspd);--accent-2:#60a5fa}
.role-marshal{--accent:var(--marshal);--accent-2:#4ade80}
.role-doj{--accent:var(--doj);--accent-2:#c084fc}
.card{
  background:rgba(2,6,23,.9);
  padding:18px 22px;
  border-radius:20px;
  margin-top:14px;
  border:1px solid rgba(255,255,255,.06);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.alert{
  background:linear-gradient(90deg,#7f1d1d,#ef4444);
  padding:18px;
  border-radius:20px;
  margin-top:14px;
  font-weight:600;
}
.popup{
  position:fixed;
  top:28px;
  right:28px;
  padding:20px 26px;
  border-radius:24px;
  background:linear-gradient(90deg,#7f1d1d,#ef4444);
  box-shadow:0 30px 60px rgba(0,0,0,.6);
  animation:slide .45s cubic-bezier(.4,0,.2,1);
}
@keyframes slide{
  from{transform:translateX(130%)}
  to{transform:translateX(0)}
}
.hidden{display:none}
</style>
</head>
<body>
<div class="tablet split">

 <header>
    <h2>üì± MDT System</h2>
    <div id="userInfo"></div>
  </header>

  <section id="login">
    <h3>Login</h3>
    <input id="username" placeholder="Benutzername" />
    <input id="password" type="password" placeholder="Passwort" />
    <button onclick="login()">Einloggen</button>
  </section>

  <nav id="mainNav" class="hidden">
    <button onclick="show('dashboard')">Startseite</button>
    <button onclick="show('employees')">Employees</button>
    <button onclick="show('laws')">Panel Code</button>
    <button onclick="show('reports')">Einsatzberichte</button>
    <button onclick="show('persons')">Personenregister</button>
    <button onclick="show('vehicles')">Fahrzeuge</button>
    <button onclick="show('wanted')">üö® Wanted</button>
    <button onclick="show('judge')">‚öñÔ∏è Richter</button>
  </nav>

<section id="dashboard" class="hidden">
  <h3>Startseite</h3>
  <input placeholder="Person suchen" />
  <input placeholder="Kennzeichen suchen" />
  <input placeholder="Wanted suchen" />
  <input placeholder="Law suchen" />
</section>

<section id="employees" class="hidden">
  <h3>üëÆ Beamten-Management</h3>

  <h4>Eigene Notizen</h4>
  <textarea id="myNotes" placeholder="Private Notizen (nur f√ºr dich sichtbar)"></textarea>

  <hr />

  <h4>Beamten registrieren</h4>
  <input id="empUsername" placeholder="Benutzername" />
  <input id="empPassword" placeholder="Startpasswort" />
  <select id="empRank">
    <option>LSPD Officer</option>
    <option>Detective</option>
    <option>Sergeant</option>
    <option>Marshal Officer</option>
    <option>Marshal Deputy</option>
    <option>Attorney</option>
    <option>Judge</option>
  </select>
  <button onclick="registerEmployee()">Registrieren</button>

  <hr />

  <h4>Beamte verwalten</h4>
  <div id="employeeList"></div>
</section>

<section id="laws" class="hidden">
  <h3>Panel Code</h3>
  <input placeholder="Law suchen" />
  <div id="lawList"></div>
</section>

<section id="reports" class="hidden">
  <h3>Einsatzberichte</h3>
  <textarea placeholder="Einsatzbericht (Vorlage je Rang)"></textarea>
  <button>Speichern</button>
</section>

<section id="persons" class="hidden">
  <h3>Personenregister</h3>
  <input placeholder="Vorname" />
  <input placeholder="Nachname" />
  <input placeholder="Geburtsdatum" />
  <input placeholder="Gr√∂√üe" />
  <input placeholder="Foto URL (optional)" />
  <button>Person anlegen</button>
</section>

<section id="vehicles" class="hidden">
  <h3>Fahrzeugregister</h3>
  <input placeholder="Marke" />
  <input placeholder="Modell" />
  <input placeholder="Farbe" />
  <input placeholder="Kennzeichen" />
  <button>Fahrzeug registrieren</button>
</section>

<section id="wanted" class="hidden">
  <h3>üö® Live-Fahndung</h3>
  <div id="wantedList"></div>
  <hr />
  <h4>üîî Auto-Alerts</h4>
  <input id="plateCheck" placeholder="Kennzeichen pr√ºfen" />
  <button onclick="checkPlate()">Check</button>
  <div id="alertBox"></div>
</section>

<section id="judge" class="hidden">
  <h3>‚öñÔ∏è Richter-Dashboard</h3>

  <h4>Haftbefehl</h4>
  <input id="judgePerson" placeholder="Person ID" />
  <textarea id="judgeReason" placeholder="Begr√ºndung"></textarea>
  <button onclick="issueWarrant(judgePerson.value,'Richter')">Haftbefehl ausstellen</button>

  <hr />

  <h4>Ermittlung sperren / freigeben</h4>
  <input id="caseId" placeholder="Ermittlungs-ID" />
  <select id="caseAction">
    <option value="lock">Sperren</option>
    <option value="unlock">Freigeben</option>
  </select>
  <button onclick="toggleCase()">Ausf√ºhren</button>
</section>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, doc, addDoc, setDoc, getDocs, Timestamp, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// ===== FIREBASE CONFIG =====
const firebaseConfig = {
  apiKey: "AIzaSyCNYAjMBgtIh64g-siP9CytOZfyRKx-BSg",
  authDomain: "mdt-los-santos-horizon.firebaseapp.com",
  databaseURL: "https://mdt-los-santos-horizon-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "mdt-los-santos-horizon",
  storageBucket: "mdt-los-santos-horizon.firebasestorage.app",
  messagingSenderId: "611944178614",
  appId: "1:611944178614:web:610fb342d748b5a027d717"
};

// Firebase initialisieren
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ===== MDT LOGIN & NAVIGATION =====
window.login = async () => {
  document.getElementById('login').classList.add('hidden');
  document.getElementById('mainNav').classList.remove('hidden');
  show('dashboard');
}

window.show = (id) => {
  document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

// ===== REGISTER EMPLOYEE =====
window.registerEmployee = async () => {
  const username = document.getElementById('empUsername').value;
  const rank = document.getElementById('empRank').value;
  if (!username) return alert("Bitte Benutzername eingeben!");

  try {
    await addDoc(collection(db, "employees"), {
      username,
      rank,
      createdAt: Timestamp.now()
    });
    alert(`Benutzer ${username} erfolgreich registriert!`);
    loadEmployees();
  } catch(err) {
    console.error("Fehler beim Registrieren:", err);
  }
}

// ===== LOAD EMPLOYEES =====
const employeeList = document.getElementById('employeeList');
async function loadEmployees() {
  employeeList.innerHTML = "";
  const snapshot = await getDocs(collection(db, "employees"));
  snapshot.forEach(docSnap => {
    const e = docSnap.data();
    const div = document.createElement('div');
    div.innerHTML = `üë§ ${e.username} | ${e.rank}`;
    employeeList.appendChild(div);
  });
}
loadEmployees();

// ===== AUDIT LOG =====
window.writeAuditLog = async (type, targetId, action, user) => {
  try {
    await addDoc(collection(db, "auditLogs"), {
      type,
      targetId,
      action,
      user,
      timestamp: Timestamp.now(),
      immutable: true
    });
  } catch(err) {
    console.error("Fehler Audit Log:", err);
  }
}

// ===== ISSUE WARRANT =====
window.issueWarrant = async (personId, judge) => {
  if (!personId) return alert("Person ID fehlt!");
  try {
    await addDoc(collection(db, "warrants"), {
      personId,
      issuedBy: judge,
      issuedAt: Timestamp.now(),
      status: "active"
    });
    writeAuditLog("warrant", personId, "create", judge);
    alert(`Haftbefehl f√ºr ${personId} ausgestellt!`);
  } catch(err) {
    console.error("Fehler Haftbefehl:", err);
  }
}

// ===== TOGGLE CASE =====
window.toggleCase = async () => {
  const caseId = document.getElementById('caseId').value;
  const action = document.getElementById('caseAction').value;
  if (!caseId) return alert("Ermittlungs-ID fehlt!");
  
  const caseRef = doc(db, "investigations", caseId);
  try {
    await updateDoc(caseRef, { locked: action === 'lock' });
    writeAuditLog("investigation", caseId, action, "Richter");
    alert(`Ermittlung ${caseId} ${action === 'lock' ? "gesperrt" : "freigegeben"}!`);
  } catch(err) {
    console.error("Fehler beim Sperren/Freigeben:", err);
  }
}

// ===== FLAG WANTED =====
window.flagWanted = async (personId, reason) => {
  if (!personId) return alert("Person ID fehlt!");
  try {
    await addDoc(collection(db, "wanted"), {
      personId,
      reason,
      flaggedAt: Timestamp.now()
    });
    writeAuditLog("person", personId, "flagWanted", "SYSTEM");
    console.log("AUTO-FLAG WANTED:", personId, reason);
  } catch(err) {
    console.error("Fehler Wanted:", err);
  }
}

// ===== STRAFRECHNER =====
window.calculatePenalty = (base, percent) => {
  return Math.round(base * (percent / 100));
};

// ===== EINSATZBERICHTE =====
let reportCounter = 1;
window.createReportTitle = (rank, dept) => {
  const prefix = dept === 'LSPD' ? 'LSPD-EINSATZ-' : 'LSMS-EINSATZ-';
  return prefix + String(reportCounter++).padStart(5,'0');
};

// ===== LAWS LIST =====
const LAWS = [
  { id: '¬ß1', de: 'Geschwindigkeits√ºberschreitung (16 km/h √ºber)', fine: 500, jail: 0 },
  { id: '¬ß2', de: 'Fahren ohne Lizenz', fine: 1500, jail: 5 }
];
const lawList = document.getElementById('lawList');
LAWS.forEach(l => {
  const div = document.createElement('div');
  div.innerHTML = `<b>${l.id}</b> ‚Äì ${l.de} | ${l.fine}$ / ${l.jail} Monate`;
  lawList.appendChild(div);
});
</script>


// ===== LOAD EMPLOYEES LIVE =====
const employeeList = document.getElementById('employeeList');
async function loadEmployees() {
  employeeList.innerHTML = "";
  const snapshot = await getDocs(collection(db, "employees"));
  snapshot.forEach(docSnap => {
    const e = docSnap.data();
    const div = document.createElement('div');
    div.innerHTML = `üë§ ${e.username} | ${e.rank}`;
    employeeList.appendChild(div);
  });
}
loadEmployees();

// ===== LAWS LIST =====
const LAWS = [
  { id: '¬ß1', de: 'Geschwindigkeits√ºberschreitung (16 km/h √ºber)', fine: 500, jail: 0 },
  { id: '¬ß2', de: 'Fahren ohne Lizenz', fine: 1500, jail: 5 }
];
const lawList = document.getElementById('lawList');
LAWS.forEach(l => {
  const div = document.createElement('div');
  div.innerHTML = `<b>${l.id}</b> ‚Äì ${l.de} | ${l.fine}$ / ${l.jail} Monate`;
  lawList.appendChild(div);
});
</script>


// ===== ROLLEN & PERMISSIONS =====
const RANKS = {
  LSPD_OFFICER: ['person_add','records_add','calculator'],
  DETECTIVE: ['person_add','records_add','calculator','investigations'],
  JUDGE: ['person_add','records_add','records_delete','calculator','investigations'],
  CHIEF_JUSTICE: ['all'],
  ATTORNEY_GENERAL: ['all','internal_affairs']
};

// ===== LAWS JSON =====
const LAWS = [
    { id: '¬ß1', de: 'Geschwindigkeits√ºberschreitung (16 km/h √ºber)', en: 'Speeding (10 mph over)', fine: 500, jail: 0 },
    { id: '¬ß2', de: 'Fahren ohne Lizenz', en: 'Driving without license', fine: 1500, jail: 5 }
  ];
  
 const lawList = document.getElementById('lawList');
  LAWS.forEach(l => {
    const div = document.createElement('div');
    div.innerHTML = `<b>${l.id}</b> ‚Äì ${l.de} | ${l.fine}$ / ${l.jail} Monate`;
    lawList.appendChild(div);
  });

// ===== STRAFRECHNER =====
window.calculatePenalty = (base, percent) => {
  return Math.round(base * (percent / 100));
};

// ===== EINSATZBERICHTE =====
let reportCounter = 1;
window.createReportTitle = (rank, dept) => {
  const prefix = dept === 'LSPD' ? 'LSPD-EINSATZ-' : 'LSMS-EINSATZ-';
  return prefix + String(reportCounter++).padStart(5,'0');
};

// ===== WANTED SYSTEM =====
window.flagWanted = (personId, reason) => {
  console.log('AUTO-FLAG WANTED:', personId, reason);
};

// ===== RICHTER DASHBOARD =====
window.issueWarrant = (personId, judge) => {
  console.log('HAFTBEFEHL:', personId, 'Richter:', judge);
};

window.approveCase = (caseId, judge) => {
  console.log('FREIGABE:', caseId, 'durch', judge);
};


// ===== AUTOMATISCHE PERSONENAKTE BEI REGISTRIERUNG =====
window.registerEmployee = async () => {
  const username = document.getElementById('empUsername').value;
  const rank = document.getElementById('empRank').value;

  const personRef = { firstName: username.split('.')[0] || username, lastName: 'DOE', autoCreated: true };
  console.log('PERSONENAKTE ANGELEGT:', personRef);

  console.log('BENUTZER REGISTRIERT:', username, rank);
};

// ===== LIVE BEAMTENLISTE =====
const employeeList = document.getElementById('employeeList');
const mockEmployees = [
  { user: 'john.doe', rank: 'LSPD Officer', status: 'Online' },
  { user: 'jane.smith', rank: 'Detective', status: 'Offline' }
];

mockEmployees.forEach(e => {
  const div = document.createElement('div');
  div.innerHTML = `üë§ ${e.user} | ${e.rank} | <b>${e.status}</b>`;
  employeeList.appendChild(div);
});

// ===== FIREBASE SECURITY RULES (LOGIK) =====
/*
match /persons/{id} {
  allow read: if request.auth != null;
  allow write: if request.auth.token.rank in ['LSPD Officer','Detective','Sergeant','Judge','Chief Justice','Attorney General'];
}

match /investigations/{id} {
  allow read, write: if request.auth.token.rank in ['Detective','Sergeant','Judge','Chief Justice','Attorney General'];
}

match /internalAffairs/{id} {
  allow read, write: if request.auth.token.rank == 'Attorney General';
}
*/


// ================== AKTEN-HISTORIE & AUDIT-LOG ==================

// Jede √Ñnderung erzeugt einen unver√§nderbaren Log-Eintrag
window.writeAuditLog = (type, targetId, action, user) => {
  const log = {
    type, // person | record | investigation | warrant
    targetId,
    action, // create | update | delete | lock | unlock
    user,
    timestamp: new Date().toISOString(),
    immutable: true
  };
  console.log('AUDIT LOG:', log);
};

// Beispiel: Akte √§ndern
window.updateRecord = (recordId, user) => {
  writeAuditLog('record', recordId, 'update', user);
};

// ================== PRODUKTIONS-FIREBASE-RULES ==================
/*
rules_version = '2';
service cloud.firestore {
 match /databases/{database}/documents {

  // USERS
  match /users/{userId} {
    allow read: if request.auth != null;
    allow write: if request.auth.token.rank == 'Attorney General';
  }

  // PERSONS
  match /persons/{id} {
    allow read: if request.auth != null;
    allow create: if request.auth.token.rank in ['LSPD Officer','Detective','Sergeant','Judge','Chief Justice','Attorney General'];
    allow update, delete: if request.auth.token.rank in ['Judge','Chief Justice','Attorney General'];
  }

  // RECORDS
  match /records/{id} {
    allow read: if request.auth != null;
    allow create, update: if request.auth.token.rank != 'LSPD Officer';
    allow delete: if request.auth.token.rank in ['Judge','Chief Justice','Attorney General'];
  }

  // INVESTIGATIONS
  match /investigations/{id} {
    allow read: if request.auth.token.rank in ['Detective','Sergeant','Judge','Chief Justice','Attorney General'];
    allow write: if request.auth.token.rank in ['Judge','Chief Justice','Attorney General']
      && resource.data.locked != true;
  }

  // INTERNAL AFFAIRS
  match /internalAffairs/{id} {
    allow read, write: if request.auth.token.rank == 'Attorney General';
  }

  // AUDIT LOGS (UNVER√ÑNDERBAR)
  match /auditLogs/{id} {
    allow create: if request.auth != null;
    allow read: if request.auth.token.rank in ['Judge','Chief Justice','Attorney General'];
    allow update, delete: if false;
  }
 }
}
*/

</script>

</body>
</html>
